<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Data Filter</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body>
    <h1>CSV Data Filter</h1>
    
    <!-- Dropdown for Association Type -->
    <label for="association-type">Association Type:</label>
    <select id="association-type">
        <option value="usage">Usage</option>
        <option value="feature">Feature</option>
    </select>
    
    <!-- Dropdown for Model Prediction -->
    <label for="model-prediction">Model Prediction:</label>
    <select id="model-prediction">
        <option value="1">Association Exists</option>
        <option value="0">No Association</option>
    </select>
    
    <!-- Dropdown for UGC Signal -->
    <label for="ugc-signal">UGC Signal:</label>
    <select id="ugc-signal">
        <option value="1">Association Exists</option>
        <option value="0">No Association</option>
    </select>
    
    <!-- Dropdown for Product Name -->
    <label for="product-name">Product Name:</label>
    <select id="product-name">
        <!-- JavaScript will populate this dropdown -->
    </select>
    
    <br><br>
    
    <!-- Display Filtered Data -->
    <table>
        <thead>
            <tr>
                <th>Keywords for Associations</th>
                <th>Association Strength</th>
            </tr>
        </thead>
        <tbody id="filtered-data">
            <!-- JavaScript will populate this table -->
        </tbody>
    </table>
    
    <script>
        // Read CSV data and filter based on user selections
        d3.csv('GAE_EdgePreds_0906.csv').then(function(data) {
            
            // Populate Product Name dropdown with unique values
            const productDropdown = document.getElementById('product-name');
            const productNames = Array.from(new Set(data.map(d => d.dst_names))).sort();
            
            productNames.forEach(function(name) {
                const option = document.createElement('option');
                option.text = name;
                option.value = name;
                productDropdown.appendChild(option);
            });
            
            // Function to update filtered data
            function updateFilteredData() {
                const associationType = document.getElementById('association-type').value;
                const modelPrediction = document.getElementById('model-prediction').value;
                const ugcSignal = document.getElementById('ugc-signal').value;
                const selectedProduct = document.getElementById('product-name').value;
                
                const filteredData = data.filter(function(d) {
                    return (
                        d.src_types === associationType &&
                        d.PredEdge === modelPrediction &&
                        d.isEdge === ugcSignal &&
                        d.dst_names === selectedProduct
                    );
                });
                
                // Display up to 20 rows
                const displayedData = filteredData.slice(0, 20);
                
                const tableBody = document.getElementById('filtered-data');
                tableBody.innerHTML = '';
                
                displayedData.forEach(function(d) {
                    const row = document.createElement('tr');
                    const cell1 = document.createElement('td');
                    const cell2 = document.createElement('td');
                    
                    cell1.textContent = d.src_names;
                    cell2.textContent = d.edge_probs;
                    
                    row.appendChild(cell1);
                    row.appendChild(cell2);
                    tableBody.appendChild(row);
                });
            }
            
            // Attach event listeners to dropdowns
            document.getElementById('association-type').addEventListener('change', updateFilteredData);
            document.getElementById('model-prediction').addEventListener('change', updateFilteredData);
            document.getElementById('ugc-signal').addEventListener('change', updateFilteredData);
            document.getElementById('product-name').addEventListener('change', updateFilteredData);
            
            // Initialize filtered data on page load
            updateFilteredData();
        });
    </script>
</body>
</html>
